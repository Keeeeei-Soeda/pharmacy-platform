# テスト計画 - 薬剤師マッチングプラットフォーム

> 最終更新日: 2025 年 11 月 26 日

---

## 📋 目次

1. [テストの進め方](#テストの進め方)
2. [事前準備](#事前準備)
3. [テスト実施順序](#テスト実施順序)
4. [詳細テストケース](#詳細テストケース)
5. [チェックリスト](#チェックリスト)

---

## テストの進め方

### 基本方針

```
【原則】依存関係の低いものから順にテスト

レベル1: 基盤機能（認証・プロフィール）
    ↓
レベル2: 基本機能（求人・応募・メッセージ）
    ↓
レベル3: 高度な機能（契約・スケジュール・証明書）
    ↓
レベル4: 統合テスト（エンドツーエンド）
```

### テスト実施の優先順位

| 優先度 | カテゴリ         | 理由                           |
| ------ | ---------------- | ------------------------------ |
| 🔴 P0  | 認証機能         | すべての機能の基盤             |
| 🔴 P0  | 環境確認         | サーバー起動・DB 接続          |
| 🟡 P1  | プロフィール管理 | 他機能で使用される基本情報     |
| 🟡 P1  | 求人掲載・応募   | プラットフォームのコア機能     |
| 🟢 P2  | メッセージ機能   | コミュニケーション             |
| 🟢 P2  | 契約管理         | 合意形成の重要機能             |
| 🔵 P3  | スケジュール管理 | 契約後の運用機能               |
| 🔵 P3  | 証明書・本人確認 | セキュリティ・コンプライアンス |
| ⚪️ P4 | 統合テスト       | 全体フローの確認               |

---

## 事前準備

### 1. 環境変数の確認

```bash
# フロントエンド (.env.local)
cat .env.local
# 期待値:
# NEXT_PUBLIC_API_URL=http://localhost:3001

# バックエンド (backend/.env)
cat backend/.env
# 期待値:
# NODE_ENV=development
# PORT=3001
# FRONTEND_URL=http://localhost:3000
# DATABASE_URL=postgresql://...
# JWT_SECRET=your-secret-key
```

### 2. サーバーの起動

```bash
# ターミナル1: バックエンド
cd backend
npm start
# → http://localhost:3001 で起動を確認

# ターミナル2: フロントエンド
npm run dev
# → http://localhost:3000 で起動を確認
```

### 3. データベースの状態確認

```bash
# Prisma Studioを起動
npx prisma studio
# → http://localhost:5555 で起動

# 既存データの確認
# - Users テーブル
# - PharmacistProfile テーブル
# - PharmacyProfile テーブル
```

### 4. ブラウザの準備

- ✅ Chrome または Firefox を使用
- ✅ 開発者ツールを開く（F12）
- ✅ Console タブと Network タブを表示
- ✅ キャッシュをクリア

---

## テスト実施順序

### 📍 推奨テストフロー

```
Phase 0: 環境確認 (5分)
    ↓
Phase 1: 認証機能テスト (15分)
    ↓
Phase 2: プロフィール管理テスト (20分)
    ↓
Phase 3: 求人・応募機能テスト (30分)
    ↓
Phase 4: メッセージ機能テスト (15分)
    ↓
Phase 5: 契約管理機能テスト (30分)
    ↓
Phase 6: スケジュール管理テスト (20分)
    ↓
Phase 7: 証明書・本人確認テスト (25分)
    ↓
Phase 8: 統合テスト (60分)
```

**合計所要時間: 約 3.5 時間**

---

## 詳細テストケース

## Phase 0: 環境確認 【P0】

### 目的

システムが正常に起動し、基本的な通信ができることを確認

### テストケース

#### TEST-ENV-001: バックエンドサーバーの起動確認

**手順:**

1. `cd backend && npm start` を実行
2. コンソールログを確認

**期待結果:**

```
✅ Server running on port 3001
✅ Database connected successfully (またはPrisma接続成功メッセージ)
```

**エラー時の対処:**

- ポートが使用中 → `lsof -ti:3001 | xargs kill -9`
- DB 接続エラー → DATABASE_URL を確認

---

#### TEST-ENV-002: フロントエンドサーバーの起動確認

**手順:**

1. `npm run dev` を実行
2. ブラウザで http://localhost:3000 にアクセス

**期待結果:**

```
✅ Next.js サーバーが起動
✅ トップページが表示される
✅ コンソールエラーがない
```

---

#### TEST-ENV-003: API 接続確認

**手順:**

1. ブラウザの開発者ツールを開く
2. Console で以下を実行:

```javascript
fetch("http://localhost:3001/api/auth/me")
  .then((r) => r.json())
  .then(console.log);
```

**期待結果:**

```
✅ レスポンスが返ってくる（認証エラーでもOK）
✅ CORSエラーが出ない
```

---

## Phase 1: 認証機能テスト 【P0】

### 目的

ユーザー登録・ログイン・ログアウトが正常に動作することを確認

---

### TEST-AUTH-001: 薬剤師の新規登録

**手順:**

1. http://localhost:3000/auth/register にアクセス
2. 「薬剤師として登録」を選択
3. 以下を入力:
   - メールアドレス: `pharmacist1@test.com`
   - パスワード: `Test1234!`
   - 姓: `田中`
   - 名: `花子`
4. 「登録」ボタンをクリック

**期待結果:**

- ✅ 登録成功メッセージが表示される
- ✅ 自動的にログインされる
- ✅ `/pharmacist/dashboard` にリダイレクトされる
- ✅ localStorage に `token` が保存される

**確認方法:**

```javascript
// ブラウザのConsoleで実行
localStorage.getItem("token");
// → トークンが表示されればOK
```

**エラーパターンと対処:**

| エラー                       | 原因                 | 対処法                       |
| ---------------------------- | -------------------- | ---------------------------- |
| "Network Error"              | バックエンド未起動   | `cd backend && npm start`    |
| "Email already exists"       | 既に登録済み         | 別のメールアドレスを使用     |
| リダイレクトされない         | フロントエンドのバグ | Console でエラーを確認       |
| ダッシュボードが表示されない | 認証トークンの問題   | localStorage の token を確認 |

---

### TEST-AUTH-002: 薬局の新規登録

**手順:**

1. 一度ログアウト（後述の手順を使用）
2. http://localhost:3000/auth/register にアクセス
3. 「薬局として登録」を選択
4. 以下を入力:
   - メールアドレス: `pharmacy1@test.com`
   - パスワード: `Test1234!`
   - 薬局名: `さくら薬局 渋谷店`
5. 「登録」ボタンをクリック

**期待結果:**

- ✅ 登録成功メッセージが表示される
- ✅ 自動的にログインされる
- ✅ `/pharmacy/dashboard` にリダイレクトされる
- ✅ localStorage に `token` が保存される

---

### TEST-AUTH-003: ログイン（薬剤師）

**手順:**

1. ログアウト
2. http://localhost:3000/auth/login にアクセス
3. 以下を入力:
   - メールアドレス: `pharmacist1@test.com`
   - パスワード: `Test1234!`
4. 「ログイン」ボタンをクリック

**期待結果:**

- ✅ ログイン成功
- ✅ 薬剤師ダッシュボードに遷移
- ✅ トークンが localStorage に保存される

---

### TEST-AUTH-004: ログイン（薬局）

**手順:**

1. ログアウト
2. http://localhost:3000/auth/login にアクセス
3. 以下を入力:
   - メールアドレス: `pharmacy1@test.com`
   - パスワード: `Test1234!`
4. 「ログイン」ボタンをクリック

**期待結果:**

- ✅ ログイン成功
- ✅ 薬局ダッシュボードに遷移

---

### TEST-AUTH-005: ログアウト

**手順:**

1. ダッシュボードのヘッダーから「ログアウト」をクリック

**期待結果:**

- ✅ ログイン画面にリダイレクトされる
- ✅ localStorage から token が削除される
- ✅ 保護されたページにアクセスするとログイン画面に戻される

**確認方法:**

```javascript
// ログアウト後、Consoleで確認
localStorage.getItem("token");
// → null であればOK
```

---

### TEST-AUTH-006: 認証エラー（間違ったパスワード）

**手順:**

1. ログイン画面で間違ったパスワードを入力
2. ログインボタンをクリック

**期待結果:**

- ✅ エラーメッセージが表示される
- ✅ ログインできない

---

### TEST-AUTH-007: 未ログイン時のアクセス制限

**手順:**

1. ログアウト状態で以下の URL に直接アクセス:
   - http://localhost:3000/pharmacist/dashboard
   - http://localhost:3000/pharmacy/dashboard

**期待結果:**

- ✅ ログイン画面にリダイレクトされる

---

## Phase 2: プロフィール管理テスト 【P1】

### 目的

プロフィール情報の表示・編集が正常に動作することを確認

---

### TEST-PROFILE-001: 薬剤師プロフィールの初期表示

**手順:**

1. 薬剤師アカウントでログイン
2. ダッシュボード > 「アカウント設定」をクリック
3. 「プロフィール情報」セクションを確認

**期待結果:**

- ✅ 登録時の情報が表示される（姓名、メールアドレス）
- ✅ 未入力項目は「未設定」または空欄
- ✅ 「編集する」ボタンが表示される

---

### TEST-PROFILE-002: 薬剤師プロフィールの編集

**手順:**

1. 「プロフィール情報」セクションで「編集する」をクリック
2. 以下の情報を入力:

```
【基本情報】
- 姓カナ: タナカ
- 名カナ: ハナコ
- 電話番号: 090-1234-5678
- 生年月日: 1990-04-15

【住所情報】
- 郵便番号: 150-0002
- 都道府県: 東京都
- 市区町村: 渋谷区
- 住所: 渋谷1-1-1
- 最寄り駅: 渋谷駅

【資格情報】
- 薬剤師免許番号: 123456
- 免許取得日: 2013-04-01
- 卒業大学: 東京薬科大学
- 卒業年: 2013
- 実務経験年数: 10

【その他】
- 自己紹介:
  調剤薬局で10年の経験があります。
  在宅医療や服薬指導に興味があります。
```

3. 「保存する」ボタンをクリック

**期待結果:**

- ✅ 「プロフィールを更新しました」というメッセージが表示される
- ✅ 編集モードが終了し、入力した内容が表示される
- ✅ ページをリロードしても情報が保持される

---

### TEST-PROFILE-003: プロフィール編集のキャンセル

**手順:**

1. 「編集する」をクリック
2. いくつかの項目を変更
3. 「キャンセル」ボタンをクリック

**期待結果:**

- ✅ 編集モードが終了する
- ✅ 変更内容が破棄される
- ✅ 元の情報が表示される

---

### TEST-PROFILE-004: 必須項目のバリデーション

**手順:**

1. 「編集する」をクリック
2. 姓または名を空欄にする
3. 「保存する」ボタンを確認

**期待結果:**

- ✅ 「保存する」ボタンが無効化される（またはエラーメッセージ）
- ✅ 必須項目が明示される

---

### TEST-PROFILE-005: 薬局プロフィールの編集

**手順:**

1. 薬局アカウントでログイン
2. ダッシュボード > 「アカウント設定」をクリック
3. 「編集する」をクリック
4. 以下の情報を入力:

```
【基本情報】
- 薬局名: さくら薬局 渋谷店
- 薬局名カナ: サクラヤッキョク シブヤテン
- 代表者名: 山田 太郎
- 電話番号: 03-1234-5678
- FAX番号: 03-1234-5679

【所在地】
- 郵便番号: 150-0002
- 都道府県: 東京都
- 市区町村: 渋谷区
- 住所: 渋谷2-1-1
- 最寄り駅: 渋谷駅 徒歩5分

【営業情報】
- 営業時間開始: 09:00
- 営業時間終了: 19:00
- 定休日: 日曜日・祝日
- 設立日: 2010-04-01

【業務情報】
- 1日処方箋枚数: 80
- スタッフ数: 5
- 薬局説明文:
  渋谷駅から徒歩5分の調剤薬局です。
  在宅医療にも対応しています。
```

5. 「保存する」をクリック

**期待結果:**

- ✅ プロフィールが更新される
- ✅ 入力内容が正しく保存される

---

## Phase 3: 求人・応募機能テスト 【P1】

### 目的

薬局が求人を掲載し、薬剤師が応募できることを確認

---

### TEST-JOB-001: 薬局が求人を掲載

**前提条件:**

- 薬局アカウントでログイン
- 薬局プロフィールが登録済み

**手順:**

1. 薬局ダッシュボード > 「募集掲載」タブをクリック
2. 「新規募集を作成」ボタンをクリック
3. 以下の情報を入力:

```
【基本情報】
- タイトル: 調剤薬局薬剤師（短期・週3日〜OK）
- 業務内容:
  調剤業務全般をお願いします。
  - 処方箋受付・調剤
  - 服薬指導
  - 薬歴管理
  - 在庫管理

【勤務条件】
- 都道府県: 東京都
- 市区町村: 渋谷区
- 住所: 渋谷2-1-1
- 最寄り駅: 渋谷駅

【給与・勤務時間】
- 時給: 3000円
- 日給: 24000円
- 勤務時間（開始）: 09:00
- 勤務時間（終了）: 18:00
- 休憩時間: 60分

【契約条件】
- 契約期間: 30日
- 勤務予定曜日: 月曜日、火曜日、水曜日、木曜日、金曜日（チェック）
- 希望開始日: 2025-12-01

【その他】
- 交通費: 実費支給
- その他条件: 処方箋枚数は1日平均80枚程度です
```

4. 「掲載する」ボタンをクリック

**期待結果:**

- ✅ 「求人を掲載しました」というメッセージが表示される
- ✅ 掲載求人一覧に新しい求人が表示される
- ✅ 求人のステータスが「募集中」になる

---

### TEST-JOB-002: 掲載求人の確認

**手順:**

1. 薬局ダッシュボード > 「募集掲載」タブ
2. 掲載した求人をクリック

**期待結果:**

- ✅ 求人詳細が表示される
- ✅ 入力した情報がすべて正しく表示される
- ✅ 「編集」「削除」ボタンが表示される

---

### TEST-JOB-003: 求人の編集

**手順:**

1. 求人詳細画面で「編集」ボタンをクリック
2. 時給を 3000 円 → 3500 円 に変更
3. 「更新する」ボタンをクリック

**期待結果:**

- ✅ 「求人を更新しました」というメッセージが表示される
- ✅ 更新内容が反映される

---

### TEST-JOB-004: 薬剤師が求人を検索

**前提条件:**

- 薬剤師アカウントでログイン

**手順:**

1. 薬剤師ダッシュボード > 「薬局募集への応募」タブをクリック
2. 検索条件を入力:
   - 都道府県: 東京都
   - 市区町村: 渋谷区
3. 「検索」ボタンをクリック

**期待結果:**

- ✅ 条件に合致する求人が表示される
- ✅ TEST-JOB-001 で作成した求人が表示される
- ✅ 求人情報（薬局名、時給、勤務時間など）が表示される

---

### TEST-JOB-005: 求人詳細の表示

**手順:**

1. 検索結果から求人をクリック
2. 求人詳細を確認

**期待結果:**

- ✅ 求人の詳細情報が表示される
- ✅ 薬局の情報が表示される
- ✅ 「応募する」ボタンが表示される

---

### TEST-JOB-006: 求人への応募

**手順:**

1. 求人詳細画面で「応募する」ボタンをクリック
2. 応募フォームに以下を入力:

```
【応募理由・自己PR】
貴薬局の求人に応募させていただきます。

調剤薬局での勤務経験が10年あり、
在宅医療にも携わってきました。

週3日の勤務希望ですが、
柔軟に対応可能です。

よろしくお願いいたします。
```

3. 「応募する」ボタンをクリック

**期待結果:**

- ✅ 「応募が完了しました」というメッセージが表示される
- ✅ 「応募済み」タブに応募が表示される
- ✅ 応募ステータスが「審査中」になる

---

### TEST-JOB-007: 応募履歴の確認（薬剤師側）

**手順:**

1. 薬剤師ダッシュボード > 「薬局募集への応募」タブ
2. 「応募済み」タブをクリック

**期待結果:**

- ✅ 応募した求人が表示される
- ✅ 応募日時が表示される
- ✅ 応募ステータスが表示される

---

### TEST-JOB-008: 応募の受信確認（薬局側）

**手順:**

1. 薬局アカウントでログイン
2. 薬局ダッシュボード > 「応募管理」タブをクリック

**期待結果:**

- ✅ 新しい応募が表示される
- ✅ 応募者の情報（氏名、経験年数など）が表示される
- ✅ 応募理由が表示される
- ✅ 「承認」「却下」ボタンが表示される

---

### TEST-JOB-009: 応募の承認（薬局側）

**手順:**

1. 応募詳細画面で「承認」ボタンをクリック
2. 確認ダイアログで「OK」をクリック

**期待結果:**

- ✅ 「応募を承認しました」というメッセージが表示される
- ✅ 応募ステータスが「承認済み」に変わる
- ✅ メッセージスレッドが自動作成される

---

## Phase 4: メッセージ機能テスト 【P2】

### 目的

薬局と薬剤師の間でメッセージのやり取りができることを確認

---

### TEST-MSG-001: メッセージスレッドの確認（薬局側）

**前提条件:**

- TEST-JOB-009 で応募を承認済み

**手順:**

1. 薬局ダッシュボード > 「メッセージ」タブをクリック

**期待結果:**

- ✅ メッセージスレッド一覧が表示される
- ✅ 承認した薬剤師とのスレッドが表示される
- ✅ 薬剤師の名前が表示される

---

### TEST-MSG-002: メッセージの送信（薬局 → 薬剤師）

**手順:**

1. メッセージスレッドを開く
2. 以下のメッセージを入力:

```
田中様

この度はご応募いただき、ありがとうございます。
さくら薬局の山田と申します。

ぜひ一度、面談させていただきたいと考えております。
以下の日程はいかがでしょうか？

・11月28日（木）14:00〜
・11月29日（金）10:00〜

ご都合をお聞かせください。
よろしくお願いいたします。
```

3. 「送信」ボタンをクリック

**期待結果:**

- ✅ メッセージが送信される
- ✅ 送信したメッセージが会話欄に表示される
- ✅ 送信時刻が表示される

---

### TEST-MSG-003: メッセージの受信確認（薬剤師側）

**手順:**

1. 薬剤師アカウントでログイン
2. 薬剤師ダッシュボード > 「メッセージ」タブをクリック

**期待結果:**

- ✅ 未読メッセージのカウントが表示される
- ✅ メッセージスレッド一覧に薬局からのスレッドが表示される
- ✅ 最新メッセージの内容が表示される

---

### TEST-MSG-004: メッセージの返信（薬剤師 → 薬局）

**手順:**

1. メッセージスレッドを開く
2. 以下のメッセージを入力:

```
山田様

ご連絡ありがとうございます。
田中と申します。

11月28日（木）14:00でお願いできますでしょうか。

当日は履歴書と薬剤師免許証を持参いたします。

よろしくお願いいたします。
```

3. 「送信」ボタンをクリック

**期待結果:**

- ✅ メッセージが送信される
- ✅ 会話の流れが正しく表示される

---

### TEST-MSG-005: 未読カウントの更新

**手順:**

1. 薬局アカウントに切り替え
2. ダッシュボードの「メッセージ」タブを確認

**期待結果:**

- ✅ 未読カウントが増えている
- ✅ 該当スレッドに未読バッジが表示される

---

### TEST-MSG-006: 既読マークの確認

**手順:**

1. 未読のメッセージスレッドを開く
2. メッセージを読む

**期待結果:**

- ✅ メッセージが既読になる
- ✅ 未読カウントが減る

---

## Phase 5: 契約管理機能テスト 【P2】

### 目的

契約オファーの送信・承諾・労働条件通知書の生成を確認

---

### TEST-CONTRACT-001: 契約オファーの送信（薬局側）

**前提条件:**

- 応募が「承認済み」ステータス

**手順:**

1. 薬局ダッシュボード > 「契約管理」タブをクリック
2. 承認済みの応募を選択
3. 「契約書を送信」ボタンをクリック
4. 以下の情報を入力:

```
【契約期間】
- 開始日: 2025-12-01
- 終了日: 2025-12-31

【給与条件】
- 時給: 3500円
- 日給: 24000円

【勤務時間】
- 開始時刻: 09:00
- 終了時刻: 18:00
- 休憩時間: 60分

【その他の労働条件】
- 交通費実費支給（上限3万円/月）
- 制服貸与
- 処方箋枚数は1日平均80枚程度
- 薬歴はPharms使用
```

5. 「送信する」ボタンをクリック

**期待結果:**

- ✅ 「契約オファーを送信しました」というメッセージが表示される
- ✅ 契約一覧に新しい契約が表示される
- ✅ 契約ステータスが「承認待ち」になる

---

### TEST-CONTRACT-002: 契約オファーの受信確認（薬剤師側）

**手順:**

1. 薬剤師アカウントでログイン
2. 薬剤師ダッシュボード > 「契約管理」タブをクリック

**期待結果:**

- ✅ 「承認待ち」タブに契約オファーが表示される
- ✅ 薬局名が表示される
- ✅ 契約期間が表示される
- ✅ 労働条件が表示される

---

### TEST-CONTRACT-003: 契約内容の確認

**手順:**

1. 契約オファーをクリックして詳細を開く

**期待結果:**

- ✅ 契約の詳細情報が表示される:
  - ✅ 契約期間（開始日・終了日）
  - ✅ 勤務時間
  - ✅ 時給・日給
  - ✅ その他の労働条件
- ✅ 「承認する」「辞退する」ボタンが表示される

---

### TEST-CONTRACT-004: 契約の承認（薬剤師側）

**手順:**

1. 契約詳細画面で「承認する」ボタンをクリック
2. 確認ダイアログで「承認する」をクリック

**期待結果:**

- ✅ 「契約を承諾しました」というメッセージが表示される
- ✅ 契約ステータスが「契約中」に変わる
- ✅ **労働条件通知書が自動生成される**
- ✅ **勤務スケジュールが自動作成される**

---

### TEST-CONTRACT-005: 労働条件通知書の確認

**手順:**

1. 契約詳細画面で「労働条件通知書を表示」をクリック

**期待結果:**

- ✅ 労働条件通知書が表示される
- ✅ 以下の情報が含まれる:
  - ✅ 発行日
  - ✅ 契約番号
  - ✅ 雇用主（薬局名、所在地）
  - ✅ 労働者（薬剤師氏名）
  - ✅ 契約期間
  - ✅ 就業場所
  - ✅ 業務内容
  - ✅ 就業時間・休憩時間
  - ✅ 勤務日
  - ✅ 賃金
  - ✅ 交通費
  - ✅ その他の労働条件

---

### TEST-CONTRACT-006: 契約一覧の確認（薬局側）

**手順:**

1. 薬局アカウントでログイン
2. 薬局ダッシュボード > 「契約管理」タブをクリック

**期待結果:**

- ✅ 承認された契約が「契約中」タブに表示される
- ✅ 契約承認日時が表示される

---

### TEST-CONTRACT-007: 契約の辞退（薬剤師側）

**前提条件:**

- 別の契約オファーを作成しておく

**手順:**

1. 契約詳細画面で「辞退する」ボタンをクリック
2. 辞退理由を入力:

```
申し訳ございませんが、
他の薬局と契約が決まったため、
こちらの契約は辞退させていただきます。

またの機会がございましたら、
よろしくお願いいたします。
```

3. 「辞退する」ボタンをクリック

**期待結果:**

- ✅ 「契約を辞退しました」というメッセージが表示される
- ✅ 契約ステータスが「辞退」に変わる
- ✅ メッセージスレッドが非表示になる（オプション）

---

## Phase 6: スケジュール管理テスト 【P3】

### 目的

契約承認時の自動スケジュール生成とカレンダー表示を確認

---

### TEST-SCHEDULE-001: スケジュール自動生成の確認

**前提条件:**

- TEST-CONTRACT-004 で契約を承認済み

**手順:**

1. 薬剤師ダッシュボード > 「出勤予定カレンダー」タブをクリック

**期待結果:**

- ✅ カレンダーが表示される
- ✅ 契約期間内の勤務予定日が青色でハイライトされる
- ✅ 勤務予定曜日（月〜金）のみがハイライトされる

---

### TEST-SCHEDULE-002: 月間カレンダーの確認

**手順:**

1. カレンダーで 2025 年 12 月を表示
2. 勤務予定日を確認

**期待結果:**

- ✅ 12 月 1 日（月）〜 12 月 31 日（水）の期間
- ✅ 月曜日〜金曜日のみが青色でハイライト
- ✅ 土曜日・日曜日はハイライトされない

**具体的な確認:**

```
12月の勤務予定日（月〜金のみ）:
1,2,3,4,5,8,9,10,11,12,15,16,17,18,19,22,23,24,25,26,29,30,31
→ 合計23日
```

---

### TEST-SCHEDULE-003: 週間カレンダーの表示

**手順:**

1. 「週間ビュー」に切り替え
2. 12 月第 1 週（12/1〜12/7）を表示

**期待結果:**

- ✅ 週間カレンダーが表示される
- ✅ 各勤務日の詳細が表示される:
  - ✅ 勤務時間（09:00〜18:00）
  - ✅ 薬局名
  - ✅ 所在地

---

### TEST-SCHEDULE-004: スケジュール詳細の表示

**手順:**

1. カレンダー上の勤務日（例: 12/1）をクリック

**期待結果:**

- ✅ スケジュール詳細モーダルが表示される
- ✅ 以下の情報が表示される:
  - ✅ 勤務日: 2025 年 12 月 1 日（月）
  - ✅ 薬局名: さくら薬局 渋谷店
  - ✅ 勤務時間: 09:00〜18:00
  - ✅ 休憩時間: 60 分
  - ✅ 実働時間: 8 時間
  - ✅ メモ: 契約開始時に自動作成されたスケジュール

---

### TEST-SCHEDULE-005: 薬局側のスケジュール確認

**手順:**

1. 薬局アカウントでログイン
2. 薬局ダッシュボード > 「勤務スケジュール管理」タブをクリック
3. 契約を選択

**期待結果:**

- ✅ 薬剤師の勤務スケジュールが表示される
- ✅ カレンダー形式で表示される
- ✅ 勤務予定日がハイライトされる

---

### TEST-SCHEDULE-006: 複数契約のスケジュール表示

**前提条件:**

- 薬剤師が複数の契約を持っている

**手順:**

1. 薬剤師ダッシュボード > 「出勤予定カレンダー」
2. 複数の契約のスケジュールを確認

**期待結果:**

- ✅ すべての契約のスケジュールが統合表示される
- ✅ 異なる薬局の勤務日が区別される（色分けなど）
- ✅ スケジュールの重複がある場合、警告が表示される

---

## Phase 7: 証明書・本人確認テスト 【P3】

### 目的

薬剤師の証明書アップロードと運営による本人確認が正常に動作することを確認

---

### TEST-CERT-001: 薬剤師免許証のアップロード

**前提条件:**

- 薬剤師アカウントでログイン

**手順:**

1. 薬剤師ダッシュボード > 「アカウント設定」タブをクリック
2. 「📄 資格証明書」セクションに移動
3. 「薬剤師免許証」の「ファイルを選択」をクリック
4. 画像ファイル（JPG または PNG、2MB 程度）を選択
5. アップロードを実行

**期待結果:**

- ✅ 「圧縮してアップロード中...」というメッセージが表示される
- ✅ アップロード完了後、「アップロードが完了しました」と表示される
- ✅ ファイル情報が表示される:
  - ✅ ファイル名
  - ✅ アップロード日時
  - ✅ ファイルサイズ（圧縮後、1MB 以下）
- ✅ 「ファイルを表示」ボタンが表示される
- ✅ 「削除」ボタンが表示される
- ✅ 「再アップロード」ボタンが表示される

**確認:**

```javascript
// ブラウザのNetworkタブで確認
// → POST /api/uploads/license
// → Status: 200
// → Response: { message: "証明書をアップロードしました", file: {...} }
```

---

### TEST-CERT-002: 保険薬剤師登録票のアップロード

**手順:**

1. 「保険薬剤師登録票」の「ファイルを選択」をクリック
2. PDF ファイルを選択（PDF は圧縮されない）
3. アップロードを実行

**期待結果:**

- ✅ PDF もアップロードできる
- ✅ ファイル情報が表示される
- ✅ 本人確認ステータスが「⏳ 本人確認待ち」になる

---

### TEST-CERT-003: アップロードした証明書の表示

**手順:**

1. 「ファイルを表示」ボタンをクリック

**期待結果:**

- ✅ 証明書画像が別タブまたはモーダルで表示される
- ✅ 画像が鮮明に表示される

---

### TEST-CERT-004: 証明書の削除

**手順:**

1. 「削除」ボタンをクリック
2. 確認ダイアログで「削除する」をクリック

**期待結果:**

- ✅ 証明書が削除される
- ✅ ファイル情報が非表示になる
- ✅ 「ファイルを選択」ボタンが再度表示される

---

### TEST-CERT-005: 証明書の再アップロード

**手順:**

1. 一度証明書をアップロード
2. 「再アップロード」ボタンをクリック
3. 新しいファイルを選択

**期待結果:**

- ✅ 古いファイルが削除される
- ✅ 新しいファイルがアップロードされる
- ✅ ファイル情報が更新される

---

### TEST-CERT-006: 運営管理画面へのアクセス

**手順:**

1. ブラウザで http://localhost:3000/admin/pharmacists にアクセス

**期待結果:**

- ✅ 運営管理画面が表示される
- ✅ 統計情報が表示される:
  - ✅ 全薬剤師数
  - ✅ 未確認の薬剤師数
  - ✅ 承認済みの薬剤師数
  - ✅ 却下された薬剤師数

**注意:**

現在は認証のみで誰でもアクセス可能。
将来的には admin ユーザータイプの権限チェックが必要。

---

### TEST-CERT-007: 薬剤師一覧の表示

**手順:**

1. 運営管理画面で薬剤師一覧を確認

**期待結果:**

- ✅ 登録済みの薬剤師が一覧表示される
- ✅ 各薬剤師の以下の情報が表示される:
  - ✅ 氏名
  - ✅ メールアドレス
  - ✅ 免許番号
  - ✅ 所在地（都道府県・市区町村）
  - ✅ 経験年数
  - ✅ 本人確認ステータス
  - ✅ 証明書アップロード状況

---

### TEST-CERT-008: ステータスフィルター

**手順:**

1. 「未確認」フィルターを選択

**期待結果:**

- ✅ 本人確認ステータスが「pending」の薬剤師のみが表示される
- ✅ 表示件数が更新される

---

### TEST-CERT-009: 検索機能

**手順:**

1. 検索ボックスに「田中」と入力

**期待結果:**

- ✅ 「田中」が含まれる薬剤師のみが表示される
- ✅ リアルタイムでフィルタリングされる

---

### TEST-CERT-010: 薬剤師詳細の表示

**手順:**

1. 薬剤師一覧で「👁」アイコンをクリック

**期待結果:**

- ✅ 薬剤師詳細モーダルが表示される
- ✅ 以下の情報が表示される:
  - ✅ 基本情報（氏名、連絡先、住所）
  - ✅ 免許情報（免許番号、経験年数）
  - ✅ 証明書アップロード状況
  - ✅ 応募履歴（最新 5 件）
  - ✅ 契約履歴（最新 5 件）

---

### TEST-CERT-011: 証明書の閲覧（運営側）

**手順:**

1. 薬剤師詳細モーダルで「ファイルを表示」をクリック

**期待結果:**

- ✅ 証明書画像が表示される
- ✅ 両方の証明書（免許証・登録票）を確認できる

---

### TEST-CERT-012: 本人確認の承認

**手順:**

1. 薬剤師詳細モーダルで「✅ 承認する」ボタンをクリック
2. 任意でメモを入力:

```
証明書を確認しました。
免許番号、氏名、写真を確認済みです。
```

3. 「承認する」ボタンをクリック

**期待結果:**

- ✅ 「本人確認を承認しました」というメッセージが表示される
- ✅ ステータスが「✅ 承認済み」に変わる
- ✅ 承認日時が記録される
- ✅ 薬剤師一覧でステータスが更新される

---

### TEST-CERT-013: 本人確認の却下

**前提条件:**

- 別の薬剤師アカウントで証明書をアップロード済み

**手順:**

1. 薬剤師詳細モーダルで「❌ 却下する」ボタンをクリック
2. 却下理由を入力（必須）:

```
証明書の画像が不鮮明です。
再度、鮮明な画像をアップロードしてください。
```

3. 「却下する」ボタンをクリック

**期待結果:**

- ✅ 却下理由の入力が必須
- ✅ 理由が空欄の場合、ボタンが無効化される
- ✅ 「本人確認を却下しました」というメッセージが表示される
- ✅ ステータスが「❌ 却下」に変わる
- ✅ 却下理由が保存される

---

### TEST-CERT-014: ステータスのリセット

**手順:**

1. 承認または却下された薬剤師の詳細を開く
2. 「🔄 リセット」ボタンをクリック

**期待結果:**

- ✅ ステータスが「⏳ 本人確認待ち」に戻る
- ✅ 承認/却下情報がクリアされる

---

## Phase 8: 統合テスト（エンドツーエンド）【P4】

### 目的

プラットフォーム全体のフローが正常に動作することを確認

---

### TEST-E2E-001: 完全な契約成立フロー

**シナリオ:**  
薬局が求人を掲載 → 薬剤師が応募 → メッセージやり取り → 契約成立 → スケジュール確認

**手順:**

1. **薬局アカウント作成・プロフィール登録**

   - 新規登録
   - プロフィール入力

2. **求人掲載**

   - 求人情報入力
   - 掲載確認

3. **薬剤師アカウント作成・プロフィール登録**

   - 新規登録
   - プロフィール入力
   - 証明書アップロード

4. **求人検索・応募**

   - 求人検索
   - 求人詳細確認
   - 応募

5. **薬局側で応募確認・承認**

   - 応募確認
   - 承認

6. **メッセージのやり取り**

   - 薬局からメッセージ送信
   - 薬剤師が返信
   - 面談日程調整

7. **契約オファー送信**

   - 薬局が契約オファー作成
   - 送信

8. **薬剤師が契約承認**

   - 契約内容確認
   - 承認
   - 労働条件通知書確認

9. **スケジュール確認**

   - 自動生成されたスケジュール確認
   - 勤務日のハイライト確認

10. **運営による本人確認**
    - 運営管理画面で証明書確認
    - 本人確認承認

**期待結果:**

- ✅ すべてのステップがエラーなく完了する
- ✅ データが正しく連携される
- ✅ 労働条件通知書が正しく生成される
- ✅ スケジュールが正しく作成される

**所要時間:** 約 30-40 分

---

### TEST-E2E-002: 契約辞退フロー

**シナリオ:**  
応募 → 契約オファー受信 → 契約辞退 → メッセージスレッド非表示

**手順:**

1. 薬剤師が求人に応募
2. 薬局が応募承認
3. 薬局が契約オファー送信
4. 薬剤師が契約辞退（理由入力）
5. 薬局側で辞退通知を確認

**期待結果:**

- ✅ 契約ステータスが「辞退」になる
- ✅ メッセージスレッドが非表示になる（オプション）
- ✅ 薬局に通知が送られる

---

### TEST-E2E-003: 複数契約の並行管理

**シナリオ:**  
薬剤師が複数の薬局と契約

**手順:**

1. 薬剤師が 2 つの異なる求人に応募
2. 両方の求人で契約成立
3. スケジュールを確認

**期待結果:**

- ✅ 複数の契約が並行して管理される
- ✅ スケジュールが統合表示される
- ✅ スケジュールの重複がある場合、警告が表示される

---

### TEST-E2E-004: 本人確認却下後の再アップロード

**シナリオ:**  
証明書アップロード → 却下 → 再アップロード → 承認

**手順:**

1. 薬剤師が証明書をアップロード
2. 運営が本人確認を却下（理由: 画像不鮮明）
3. 薬剤師が証明書を再アップロード
4. 運営が本人確認を承認

**期待結果:**

- ✅ 却下理由が薬剤師に表示される
- ✅ 再アップロードが可能
- ✅ 承認後、ステータスが更新される

---

## チェックリスト

### 全体チェックリスト

#### Phase 0: 環境確認

- [ ] バックエンドサーバーが起動する
- [ ] フロントエンドサーバーが起動する
- [ ] API 接続が正常
- [ ] データベース接続が正常

#### Phase 1: 認証機能

- [ ] 薬剤師として新規登録できる
- [ ] 薬局として新規登録できる
- [ ] ログインできる（薬剤師）
- [ ] ログインできる（薬局）
- [ ] ログアウトできる
- [ ] 認証エラーが正しく表示される
- [ ] 未ログイン時のアクセス制限が機能する

#### Phase 2: プロフィール管理

- [ ] 薬剤師プロフィールが表示される
- [ ] 薬剤師プロフィールを編集できる
- [ ] 編集をキャンセルできる
- [ ] 必須項目のバリデーションが機能する
- [ ] 薬局プロフィールを編集できる

#### Phase 3: 求人・応募機能

- [ ] 薬局が求人を掲載できる
- [ ] 掲載求人を確認できる
- [ ] 求人を編集できる
- [ ] 薬剤師が求人を検索できる
- [ ] 求人詳細が表示される
- [ ] 求人に応募できる
- [ ] 応募履歴が表示される（薬剤師側）
- [ ] 応募を受信確認できる（薬局側）
- [ ] 応募を承認できる（薬局側）

#### Phase 4: メッセージ機能

- [ ] メッセージスレッドが表示される
- [ ] メッセージを送信できる（薬局 → 薬剤師）
- [ ] メッセージを受信できる（薬剤師側）
- [ ] メッセージを返信できる（薬剤師 → 薬局）
- [ ] 未読カウントが更新される
- [ ] 既読マークが機能する

#### Phase 5: 契約管理機能

- [ ] 契約オファーを送信できる（薬局側）
- [ ] 契約オファーを受信できる（薬剤師側）
- [ ] 契約内容を確認できる
- [ ] 契約を承認できる（薬剤師側）
- [ ] 労働条件通知書が自動生成される
- [ ] 労働条件通知書を確認できる
- [ ] 契約一覧が表示される（薬局側）
- [ ] 契約を辞退できる（薬剤師側）

#### Phase 6: スケジュール管理

- [ ] スケジュールが自動生成される
- [ ] 月間カレンダーが表示される
- [ ] 週間カレンダーが表示される
- [ ] スケジュール詳細が表示される
- [ ] 薬局側でスケジュール確認できる
- [ ] 複数契約のスケジュールが統合表示される

#### Phase 7: 証明書・本人確認

- [ ] 薬剤師免許証をアップロードできる
- [ ] 保険薬剤師登録票をアップロードできる
- [ ] 証明書を表示できる
- [ ] 証明書を削除できる
- [ ] 証明書を再アップロードできる
- [ ] 運営管理画面にアクセスできる
- [ ] 薬剤師一覧が表示される
- [ ] ステータスフィルターが機能する
- [ ] 検索機能が機能する
- [ ] 薬剤師詳細が表示される
- [ ] 証明書を閲覧できる（運営側）
- [ ] 本人確認を承認できる
- [ ] 本人確認を却下できる
- [ ] ステータスをリセットできる

#### Phase 8: 統合テスト

- [ ] 完全な契約成立フローが機能する
- [ ] 契約辞退フローが機能する
- [ ] 複数契約の並行管理が機能する
- [ ] 本人確認却下後の再アップロードが機能する

---

## バグ報告テンプレート

エラーを発見した場合、以下のテンプレートを使用して報告してください：

````markdown
## バグ報告: [簡潔なタイトル]

### 基本情報

- **テストケース**: TEST-XXX-XXX
- **優先度**: 🔴 高 / 🟡 中 / 🟢 低
- **再現率**: 100% / 50% / 稀

### 再現手順

1. [手順 1]
2. [手順 2]
3. [手順 3]

### 期待される動作

[何が起こるべきか]

### 実際の動作

[実際に何が起こったか]

### エラーメッセージ

\```
[エラーメッセージをここに貼り付け]
\```

### スクリーンショット

[可能であれば添付]

### 環境

- OS: macOS 24.5.0
- ブラウザ: Chrome 120
- Node.js: v18.x
````

---

## テスト実施記録

### テスト実施日: \_\_\_\_年\_\_月\_\_日

| Phase                     | 実施者 | 結果  | バグ数 | 備考 |
| ------------------------- | ------ | ----- | ------ | ---- |
| Phase 0: 環境確認         |        | ✅/❌ |        |      |
| Phase 1: 認証機能         |        | ✅/❌ |        |      |
| Phase 2: プロフィール     |        | ✅/❌ |        |      |
| Phase 3: 求人・応募       |        | ✅/❌ |        |      |
| Phase 4: メッセージ       |        | ✅/❌ |        |      |
| Phase 5: 契約管理         |        | ✅/❌ |        |      |
| Phase 6: スケジュール     |        | ✅/❌ |        |      |
| Phase 7: 証明書・本人確認 |        | ✅/❌ |        |      |
| Phase 8: 統合テスト       |        | ✅/❌ |        |      |

---

**最終更新:** 2025 年 11 月 26 日  
**バージョン:** 1.0.0
