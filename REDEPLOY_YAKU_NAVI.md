# ğŸš€ yaku-navi.com å®Œå…¨å†ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼ˆPM2å¼·åŒ–ç‰ˆï¼‰

**å¯¾è±¡ã‚µãƒ¼ãƒãƒ¼**: yaku-navi.com  
**ä½œæˆæ—¥**: 2026å¹´1æœˆ25æ—¥  
**æ‰€è¦æ™‚é–“**: ç´„30-40åˆ†

---

## ğŸ“‹ æ¦‚è¦

### ç¾åœ¨ã®çŠ¶æ³
- âŒ **yaku-navi.com**: 502ã‚¨ãƒ©ãƒ¼ï¼ˆBad Gatewayï¼‰
- âŒ PM2ãƒ—ãƒ­ã‚»ã‚¹ãŒåœæ­¢ã¾ãŸã¯ç•°å¸¸çµ‚äº†ã—ã¦ã„ã‚‹å¯èƒ½æ€§

### å®Ÿæ–½å†…å®¹
1. VPSã‚µãƒ¼ãƒãƒ¼ã«å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
2. PM2è‡ªå‹•å†èµ·å‹•è¨­å®šã®å¼·åŒ–
3. ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•æ™‚ã®è‡ªå‹•èµ·å‹•è¨­å®š
4. å‹•ä½œç¢ºèª

### æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ
- âœ… 502ã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆ
- âœ… PM2ã®è‡ªå‹•å†èµ·å‹•ãŒå¼·åŒ–ã•ã‚Œã‚‹
- âœ… ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•å¾Œã‚‚è‡ªå‹•ã§èµ·å‹•
- âœ… ãƒ¡ãƒ¢ãƒªåˆ¶é™è¶…éæ™‚ã®è‡ªå‹•å†èµ·å‹•
- âœ… æ¯æ—¥å®šæœŸçš„ã«è‡ªå‹•å†èµ·å‹•ï¼ˆåˆå‰4æ™‚ï¼‰

---

## ğŸ”§ Step 1: ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®æº–å‚™ï¼ˆ5åˆ†ï¼‰

### 1-1. æœ€æ–°ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª

```bash
cd /Users/soedakei/pharmacy-platform

# ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒç¢ºèª
git branch

# æœ€æ–°ã®å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "PM2è‡ªå‹•å†èµ·å‹•è¨­å®šå¼·åŒ– & 502ã‚¨ãƒ©ãƒ¼å¯¾å¿œ"
```

### 1-2. å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```bash
ls -la ecosystem.config.js
ls -la backend/package.json
ls -la package.json
ls -la next.config.ts
```

---

## ğŸŒ Step 2: VPSã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆ10åˆ†ï¼‰

### æ–¹æ³•A: rsyncã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆæ¨å¥¨ï¼‰

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰å®Ÿè¡Œ
cd /Users/soedakei/pharmacy-platform

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
rsync -avz --exclude 'node_modules' --exclude '.git' \
  backend/ ãƒ¦ãƒ¼ã‚¶ãƒ¼å@yaku-navi.com:/var/www/pharmacy-platform/backend/

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
rsync -avz --exclude 'node_modules' --exclude '.git' --exclude '.next' \
  --exclude 'app' --exclude 'components' --exclude 'lib' \
  . ãƒ¦ãƒ¼ã‚¶ãƒ¼å@yaku-navi.com:/var/www/pharmacy-platform/

# ecosystem.config.jsã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆé‡è¦ï¼‰
scp ecosystem.config.js ãƒ¦ãƒ¼ã‚¶ãƒ¼å@yaku-navi.com:/var/www/pharmacy-platform/

# package.jsonã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
scp package.json ãƒ¦ãƒ¼ã‚¶ãƒ¼å@yaku-navi.com:/var/www/pharmacy-platform/
scp backend/package.json ãƒ¦ãƒ¼ã‚¶ãƒ¼å@yaku-navi.com:/var/www/pharmacy-platform/backend/
```

### æ–¹æ³•B: FTPã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

1. FileZillaãªã©ã®FTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’èµ·å‹•
2. yaku-navi.comã«æ¥ç¶š
3. ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼š
   - `ecosystem.config.js` âœ… **é‡è¦**
   - `backend/src/`
   - `backend/package.json`
   - `package.json`
   - `.next/`ï¼ˆãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã®å ´åˆï¼‰

---

## ğŸ” Step 3: VPSã‚µãƒ¼ãƒãƒ¼ã«SSHæ¥ç¶šï¼ˆ1åˆ†ï¼‰

```bash
ssh ãƒ¦ãƒ¼ã‚¶ãƒ¼å@yaku-navi.com
```

ã¾ãŸã¯

```bash
ssh ãƒ¦ãƒ¼ã‚¶ãƒ¼å@ã‚µãƒ¼ãƒãƒ¼IP
```

---

## ğŸ› ï¸ Step 4: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ï¼ˆ1åˆ†ï¼‰

```bash
cd /var/www/pharmacy-platform

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ç¢ºèª
ls -la
```

**ç¢ºèªé …ç›®:**
- âœ… `ecosystem.config.js` ãŒå­˜åœ¨ã™ã‚‹
- âœ… `backend/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã™ã‚‹
- âœ… `package.json` ãŒå­˜åœ¨ã™ã‚‹

---

## ğŸ“¦ Step 5: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆ5åˆ†ï¼‰

### 5-1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ä¾å­˜é–¢ä¿‚

```bash
cd /var/www/pharmacy-platform/backend
npm install --production
```

### 5-2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä¾å­˜é–¢ä¿‚

```bash
cd /var/www/pharmacy-platform
npm install --production
```

### 5-3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ã—ã¦ã„ãªã„å ´åˆï¼‰

```bash
npm run build
```

**æ³¨æ„**: ãƒ“ãƒ«ãƒ‰ã«ã¯5-10åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

---

## ğŸ”„ Step 6: PM2ãƒ—ãƒ­ã‚»ã‚¹ã®å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆ3åˆ†ï¼‰

### 6-1. ç¾åœ¨ã®PM2ãƒ—ãƒ­ã‚»ã‚¹ã‚’å…¨ã¦åœæ­¢ãƒ»å‰Šé™¤

```bash
cd /var/www/pharmacy-platform

# ç¾åœ¨ã®ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
pm2 status

# å…¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
pm2 stop all

# å…¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’å‰Šé™¤
pm2 delete all

# PM2ãƒ—ãƒ­ã‚»ã‚¹ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
pm2 flush
```

### 6-2. PM2ãƒªã‚¹ãƒˆã®ç¢ºèª

```bash
pm2 list
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:**
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name â”‚ version â”‚ mode    â”‚ pid  â”‚ statusâ”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚      â”‚         â”‚         â”‚      â”‚      â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

ï¼ˆç©ºã®ãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OKï¼‰

---

## ğŸš€ Step 7: PM2ã§æ–°ã—ã„è¨­å®šã§èµ·å‹•ï¼ˆ3åˆ†ï¼‰

### 7-1. ecosystem.config.jsã§èµ·å‹•

```bash
cd /var/www/pharmacy-platform

# æ–°ã—ã„è¨­å®šã§èµ·å‹•
pm2 start ecosystem.config.js

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
pm2 status
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:**
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name                  â”‚ version â”‚ mode    â”‚ pid  â”‚ status â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ pharmacy-backend      â”‚ N/A     â”‚ fork    â”‚ XXXX â”‚ online â”‚
â”‚ 1   â”‚ pharmacy-frontend     â”‚ N/A     â”‚ fork    â”‚ XXXX â”‚ online â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ä¸¡æ–¹ã¨ã‚‚ **`online`** ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼

### 7-2. ãƒ­ã‚°ã‚’ç¢ºèª

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚°
pm2 logs pharmacy-backend --lines 20

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ­ã‚°
pm2 logs pharmacy-frontend --lines 20
```

**ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª**

---

## ğŸ’¾ Step 8: PM2è¨­å®šã‚’ä¿å­˜ï¼ˆ2åˆ†ï¼‰

### 8-1. ç¾åœ¨ã®ãƒ—ãƒ­ã‚»ã‚¹ãƒªã‚¹ãƒˆã‚’ä¿å­˜

```bash
pm2 save
```

**å‡ºåŠ›:**
```
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
```

### 8-2. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ã®è‡ªå‹•èµ·å‹•ã‚’è¨­å®š

```bash
# systemdã®èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆ
pm2 startup systemd

# è¡¨ç¤ºã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼ˆä¾‹ï¼‰
sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u ãƒ¦ãƒ¼ã‚¶ãƒ¼å --hp /home/ãƒ¦ãƒ¼ã‚¶ãƒ¼å
```

**æ³¨æ„**: è¡¨ç¤ºã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’ãã®ã¾ã¾å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### 8-3. è¨­å®šã‚’å†ä¿å­˜

```bash
pm2 save
```

---

## âœ… Step 9: å‹•ä½œç¢ºèªï¼ˆ5åˆ†ï¼‰

### 9-1. ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã®ç¢ºèª

```bash
pm2 status
```

**ç¢ºèªé …ç›®:**
- âœ… ä¸¡æ–¹ã¨ã‚‚ `online`
- âœ… `restart` ãŒ 0 ã¾ãŸã¯å°‘ãªã„æ•°å€¤
- âœ… `uptime` ãŒå¢—ãˆã¦ã„ã‚‹

### 9-2. ãƒãƒ¼ãƒˆç¢ºèª

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒˆ
netstat -tuln | grep 3001

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒˆ
netstat -tuln | grep 3000
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:**
```
tcp6       0      0 :::3001                 :::*                    LISTEN
tcp6       0      0 :::3000                 :::*                    LISTEN
```

### 9-3. curlã§APIç¢ºèª

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API
curl http://localhost:3001/

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
curl http://localhost:3000/
```

### 9-4. ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª

1. **https://yaku-navi.com** ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. **https://yaku-navi.com/invoice-issued** ã«ã‚¢ã‚¯ã‚»ã‚¹
4. è«‹æ±‚æ›¸ç™ºè¡Œãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

---

## ğŸ” Step 10: PM2è©³ç´°è¨­å®šã®ç¢ºèªï¼ˆ3åˆ†ï¼‰

### 10-1. PM2è¨­å®šã®ç¢ºèª

```bash
pm2 show pharmacy-backend
pm2 show pharmacy-frontend
```

**ç¢ºèªé …ç›®:**
- âœ… `autorestart`: true
- âœ… `max_memory_restart`: è¨­å®šã•ã‚Œã¦ã„ã‚‹
- âœ… `max_restarts`: 15
- âœ… `cron_restart`: è¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆæ¯æ—¥åˆå‰4æ™‚ï¼‰

### 10-2. PM2ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
# PM2ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pm2 install pm2-logrotate

# è¨­å®š
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
pm2 set pm2-logrotate:compress true
```

---

## ğŸ¯ Step 11: æœ€çµ‚ç¢ºèªã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼ˆ5åˆ†ï¼‰

### 11-1. PM2ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
pm2 monit
```

**ç¢ºèªé …ç›®:**
- CPUä½¿ç”¨ç‡
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°

### 11-2. 5åˆ†é–“ã®å®‰å®šæ€§ç¢ºèª

```bash
# 5åˆ†å¾…ã¤
sleep 300

# ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ…‹ã‚’ç¢ºèª
pm2 status
```

**ç¢ºèªé …ç›®:**
- âœ… ä¸¡æ–¹ã¨ã‚‚ `online` ã®ã¾ã¾
- âœ… `restart` ãŒå¢—ãˆã¦ã„ãªã„

### 11-3. ãƒ­ã‚°ã«ç•°å¸¸ãŒãªã„ã‹ç¢ºèª

```bash
pm2 logs --lines 50
```

---

## ğŸ“Š æ–°ã—ã„PM2è¨­å®šã®è©³ç´°

### å¼·åŒ–ã•ã‚ŒãŸè‡ªå‹•å†èµ·å‹•è¨­å®š

| è¨­å®šé …ç›® | å€¤ | èª¬æ˜ |
|---------|-----|------|
| `autorestart` | true | ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢æ™‚ã«è‡ªå‹•å†èµ·å‹• |
| `max_restarts` | 15 | æœ€å¤§å†èµ·å‹•å›æ•°ï¼ˆ10â†’15ã«å¢—åŠ ï¼‰ |
| `restart_delay` | 5000ms | å†èµ·å‹•ã¾ã§ã®å¾…æ©Ÿæ™‚é–“ |
| `exp_backoff_restart_delay` | 100ms | æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•å†èµ·å‹• |
| `max_memory_restart` | 500M/1G | ãƒ¡ãƒ¢ãƒªåˆ¶é™è¶…éæ™‚ã«å†èµ·å‹• |
| `min_uptime` | 10s | æœ€å°ç¨¼åƒæ™‚é–“ |
| `kill_timeout` | 5000ms | ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ |
| `cron_restart` | 0 4 * * * | æ¯æ—¥åˆå‰4æ™‚ã«å®šæœŸå†èµ·å‹• |

### å®šæœŸçš„ãªè‡ªå‹•å†èµ·å‹•

- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: æ¯æ—¥åˆå‰4:00ã«è‡ªå‹•å†èµ·å‹•
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: æ¯æ—¥åˆå‰4:05ã«è‡ªå‹•å†èµ·å‹•

ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚„ãƒªã‚½ãƒ¼ã‚¹è“„ç©ã‚’é˜²ããŸã‚ã®äºˆé˜²æªç½®ã€‚

---

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼1: `pm2 command not found`

**åŸå› **: PM2ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:
```bash
sudo npm install -g pm2
```

### ã‚¨ãƒ©ãƒ¼2: ãƒ—ãƒ­ã‚»ã‚¹ãŒã™ãã«åœæ­¢ã™ã‚‹

**åŸå› **: ä¾å­˜é–¢ä¿‚ã®ã‚¨ãƒ©ãƒ¼ã€ãƒãƒ¼ãƒˆç«¶åˆ

**è§£æ±ºç­–**:
```bash
# ãƒ­ã‚°ã‚’ç¢ºèª
pm2 logs pharmacy-backend --err --lines 50

# ãƒãƒ¼ãƒˆç¢ºèª
lsof -i :3001
lsof -i :3000

# ä¾å­˜é–¢ä¿‚ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd /var/www/pharmacy-platform/backend
rm -rf node_modules
npm install --production
```

### ã‚¨ãƒ©ãƒ¼3: `502 Bad Gateway` ãŒç¶™ç¶š

**åŸå› **: Nginxã®è¨­å®šã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒˆã®ä¸ä¸€è‡´

**è§£æ±ºç­–**:
```bash
# Nginxè¨­å®šã‚’ç¢ºèª
sudo nginx -t

# Nginxå†èµ·å‹•
sudo systemctl restart nginx

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒˆç¢ºèª
netstat -tuln | grep 3001
```

### ã‚¨ãƒ©ãƒ¼4: ãƒ¡ãƒ¢ãƒªä¸è¶³

**åŸå› **: VPSã®ãƒ¡ãƒ¢ãƒªãŒä¸è¶³

**è§£æ±ºç­–**:
```bash
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨çŠ¶æ³ç¢ºèª
free -h

# ã‚¹ãƒ¯ãƒƒãƒ—é ˜åŸŸã®ä½œæˆï¼ˆå¿…è¦ãªå ´åˆï¼‰
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

---

## ğŸ“ ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å³åº§ã«ç¢ºèª

- [ ] PM2ãƒ—ãƒ­ã‚»ã‚¹ãŒ `online` ã«ãªã£ã¦ã„ã‚‹
- [ ] ãƒãƒ¼ãƒˆ3001ã¨3000ãŒ LISTEN çŠ¶æ…‹
- [ ] https://yaku-navi.com ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
- [ ] https://yaku-navi.com/invoice-issued ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹

### 5åˆ†å¾Œã«ç¢ºèª

- [ ] PM2ãƒ—ãƒ­ã‚»ã‚¹ãŒ `online` ã®ã¾ã¾
- [ ] `restart` ã‚«ã‚¦ãƒ³ãƒˆãŒå¢—ãˆã¦ã„ãªã„
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒå‡ºã¦ã„ãªã„

### 30åˆ†å¾Œã«ç¢ºèª

- [ ] PM2ãƒ—ãƒ­ã‚»ã‚¹ãŒå®‰å®šã—ã¦ã„ã‚‹
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒæ­£å¸¸ç¯„å›²å†…
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ãªã©å„æ©Ÿèƒ½ãŒæ­£å¸¸å‹•ä½œ

### ç¿Œæ—¥ç¢ºèª

- [ ] åˆå‰4æ™‚ã®å®šæœŸå†èµ·å‹•ãŒå®Ÿè¡Œã•ã‚ŒãŸ
- [ ] å†èµ·å‹•å¾Œã‚‚æ­£å¸¸å‹•ä½œã—ã¦ã„ã‚‹

---

## ğŸ”„ ä»Šå¾Œã®æ›´æ–°æ–¹æ³•

### ã‚³ãƒ¼ãƒ‰æ›´æ–°æ™‚

```bash
# 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "æ›´æ–°å†…å®¹"

# 2. ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
rsync -avz --exclude 'node_modules' \
  backend/ ãƒ¦ãƒ¼ã‚¶ãƒ¼å@yaku-navi.com:/var/www/pharmacy-platform/backend/

# 3. SSHæ¥ç¶š
ssh ãƒ¦ãƒ¼ã‚¶ãƒ¼å@yaku-navi.com

# 4. PM2ã§å†èµ·å‹•
cd /var/www/pharmacy-platform
pm2 restart all

# 5. ç¢ºèª
pm2 status
```

---

## ğŸ“Š PM2ã‚³ãƒãƒ³ãƒ‰æ—©è¦‹è¡¨

```bash
# çŠ¶æ…‹ç¢ºèª
pm2 status

# ãƒ­ã‚°ç¢ºèª
pm2 logs
pm2 logs pharmacy-backend --lines 100

# å†èµ·å‹•
pm2 restart all
pm2 restart pharmacy-backend

# åœæ­¢
pm2 stop all

# ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
pm2 monit

# è©³ç´°æƒ…å ±
pm2 show pharmacy-backend

# è¨­å®šä¿å­˜
pm2 save

# ãƒ—ãƒ­ã‚»ã‚¹å‰Šé™¤
pm2 delete all
```

---

## ğŸŠ å®Œäº†ï¼

ã“ã®æ‰‹é †ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ãŒå®Ÿç¾ã•ã‚Œã¾ã™ï¼š

1. âœ… **502ã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆ**
2. âœ… **PM2è‡ªå‹•å†èµ·å‹•ã®å¼·åŒ–**
3. âœ… **ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•æ™‚ã®è‡ªå‹•èµ·å‹•**
4. âœ… **ãƒ¡ãƒ¢ãƒªåˆ¶é™è¶…éæ™‚ã®è‡ªå‹•å†èµ·å‹•**
5. âœ… **æ¯æ—¥å®šæœŸçš„ãªè‡ªå‹•å†èµ·å‹•**
6. âœ… **ã‚ˆã‚Šå®‰å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹é‹ç”¨**

---

**ä½œæˆè€…**: AI Assistant  
**ä½œæˆæ—¥**: 2026å¹´1æœˆ25æ—¥  
**æœ€çµ‚æ›´æ–°**: 2026å¹´1æœˆ25æ—¥

